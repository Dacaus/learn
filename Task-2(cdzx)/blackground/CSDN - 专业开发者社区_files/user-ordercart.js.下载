"use strict";!function(t,e){function n(t){var e,n=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(n))?unescape(e[2]):null}function i(t){for(var e=document.cookie.split(";"),n={},i=0;i<e.length;i++){var o=e[i].split("=");t&&o[0].toString().trim().lastIndexOf("_app")===o[0].toString().trim().length-"_app".length?n[o[0].toString().trim().replace("_app","")]=o[1]:t||0!==o[0].toString().trim().indexOf("c_")||(n[o[0].toString().trim()]=o[1])}return n}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.product_id=t.product_id||0,t.goods_id=t.goods_id||0,t.num=t.num||1,t.is_ajax=t.is_ajax||1,t.t=t.t||(new Date).getTime(),t.device_id=r(),t.device_type=c(),t.utm_source_ext=a(),t}function s(){var t=n("X-App-ID")||"";return"CSDN-APP"==t||"CSDN-EDU"==t}function r(){var t=n("X-App-ID")||"";return"CSDN-APP"==t||"CSDN-EDU"==t?n("X-Device-ID")||"":n("uuid_tt_dd")||""}function a(){var t={};return t=i(s()),s()?t.dc_sid=n("dc_sid_app")||"":t.dc_sid=n("dc_sid")||"",JSON.stringify(t)}function c(){var t,e=g.isEDUIos(),i=g.isEDUAndroid(),o=g.isAndroid(),s=n("X-App-ID")||"",r=n("X-OS")||"";return g.isWap()||(t=10),g.isMac()&&(t=11),g.isWap()&&(t=9),i&&o&&(t=3),e&&(t=4),"CSDN-APP"==s&&"Android"==r&&(t=1),"CSDN-APP"==s&&"iOS"==r&&(t=2),"CSDN-EDU"==s&&"Android"==r&&(t=3),"CSDN-EDU"==s&&"iOS"==r&&(t=4),t}function u(){void 0!==h.timer&&clearInterval(h.timer),void 0!==h.timershow&&clearInterval(h.timershow)}function d(e){var n=t.location.host,i="",o=document.location.protocol;return n.match(/^beta[a-z]*/)||n.match(/^test[a-z]*/)?i="beta":n.match(/^l[a-z]*/)?i="l":n.match(/^pre-[a-z]*/)?i="pre-":"lab.csdn.net"===n&&(i=""),o+"//"+i+e}function l(t){var e="";for(var n in t)"function"!=typeof t[n]&&(e+=n+"="+t[n]+"&");return"?"+(e=e.substr(0,e.length-1))}function p(t){t(),u()}function _(e){1===e.status?(h.ident=!1,f(),null!==y?y(e):setTimeout(function(){t.location.replace(e.url)},300)):3===e.status?(0===h.payment_flag&&"function"==typeof h.payment_function&&(h.payment_flag=1,h.payment_function(),m()),h.ident=!0):0===e.status?(void 0,h.ident=!1):h.ident=!0}function f(){(new Image).src=h.cart_url+"mp/order/pay/delScanPayCache/"+h.cacheKey}function m(){(new Image).src=h.order_url+"mp/order/pay/getStatus/delScanPaymentCache/"+h.sign}function h(){this.timer=0,this.timershow=0,this.ident=!0,this.pay_code_timeout=3e5,this.get_status_sec=3e3,this.timeout_time=1e4,this.payment_flag=0,this.payment_function=null,this.no_login=0,this.cacheKey="",this.sign="",this.cart_url=d("mall.csdn.net/"),this.order_url=d("order.csdn.net/"),this.get_status_url=this.cart_url+"mp/order/pay/getStatus",this.order_number="",this.deviceDistinguish=g}var y=null,g={ua:t.navigator.userAgent.toLowerCase(),isEDUIos:function(){return/(?:csdnedu-ipad)/.test(this.ua)},isEDUAndroid:function(){return/(?:csdnedu)/.test(this.ua)},isAndroid:function(){return/(?:android)/.test(this.ua)},isWindowsPhone:function(){return/(?:windows phone)/.test(this.ua)},isSymbian:function(){return/(?:symbianos)/.test(this.ua)||this.isWindowsPhone},isFireFox:function(){return/(?:firefox)/.test(this.ua)},isChrome:function(){return/(?:chrome|crios)/.test(this.ua)},isTablet:function(){return/(?:ipad|playbook)/.test(this.ua)||this.isAndroid&&!/(?:mobile)/.test(this.ua)||this.isFireFox&&/(?:tablet)/.test(this.ua)},isPhone:function(){return/(?:iphone)/.test(this.ua)&&!this.isTablet},isPc:function(){return!this.isPhone&&!this.isAndroid&&!this.isSymbian},isWechatdevtools:function(){return/wechatdevtools/.test(this.ua)},isMac:function(){return t.navigator.platform.toLocaleLowerCase().indexOf("mac")>-1},isMicromessenger:function(){return/micromessenger/.test(this.ua)},isWap:function(){return!!this.ua.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}};h.prototype={constructor:h,buyNow:function(e){var n=t.location.host,i="",o=document.location.protocol;(n.match(/^beta[a-z]*/)||n.match(/^test[a-z]*/))&&(i="test-");var s="";s=this.deviceDistinguish.isWap()?"order.csdn.net/v2/m/submit":"order.csdn.net/v2/order-m/submit",t.location.href=o+"//"+i+s+l(e)},qrPay:function(t){var n,i,s,r=this;t=o(t),"function"==typeof t.success_function&&(n=t.success_function,delete t.success_function),"function"==typeof t.error_function&&(i=t.error_function,delete t.error_function),"function"==typeof t.timeout_function&&(s=t.timeout_function,delete t.timeout_function),"function"==typeof t.payment_function?(h.payment_function=t.payment_function,delete t.payment_function):h.payment_function=null,"function"==typeof t.get_pay_success_callback&&(y=t.get_pay_success_callback,delete t.get_pay_success_callback),h.payment_flag=0;var a=e.ajax({type:"get",url:this.cart_url+"mp/order/pay/qrPay",data:t,dataType:"jsonp",jsonp:"callback",jsonpCallback:"qrPayCallback",timeout:this.timeout_time,success:function(e){if(1===e.status)return n(t.request_type,e),r.cacheKey=e.cacheKey,r.sign=e.sign,u(),r.get_status_url=e.get_status_url,r.timer=setInterval(function(){r.get_pay_status()},r.get_status_sec),r.timershow=setInterval(function(){p(s)},r.pay_code_timeout),!1;i(e)},error:function(){i({status:15,errorMessage:"获取二维码失败"})},complete:function(t,e){"timeout"===e&&a.abort()}})},cancel_pay:function(){u()},get_pay_status:function(){var t=this;if(!1===h.ident)return!1;h.ident=!1,e.ajax({type:"get",url:t.get_status_url,async:!1,data:{order_number:t.order_number,type:t.request_type,no_login:t.no_login,flag:1,t:(new Date).getTime(),is_ajax:1},dataType:"jsonp",jsonp:"callback",jsonpCallback:"get_pay_status",timeout:t.timeout_time,success:function(t){_(t)},error:function(){h.ident=!0}})}},t.csdn=t.csdn||{},t.csdn.cart=new h,t.cart=new h}(window,jQuery);