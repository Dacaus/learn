"use strict";!function(e,i,a){function o(e,i){return(100*e-100*i)/100}function d(e,o){QRCode?o.pay_url&&(x=o.pay_url,a("#ordertip_qr_code").html(""),a("#ordertip_notify").hide(),new QRCode(i.getElementById("ordertip_qr_code"),{text:o.pay_url,width:130,height:130})):console.warn("qrcode脚本不存在，请检查！")}function r(e,o){o=isNaN(o)?3e3:o;var d=i.createElement("div");d.innerHTML=e,d.style.cssText="width:124px;opacity: 0.8;height: 40px;background:rgba(34,34,38,1);color: rgb(255, 255, 255);line-height: 40px;text-align: center;border-radius: 4px;position: fixed;top: 35%;left:50%;margin-left:-62px;z-index: 999999;font-size: 16px;",i.getElementById("user-ordertip").appendChild(d),setTimeout(function(){d.style.webkitTransition="-webkit-transform 0.5s ease-in, opacity 0.5s ease-in",d.style.opacity="0",setTimeout(function(){i.getElementById("user-ordertip").removeChild(d),a("#user-ordertip-box").remove(),window.location.reload()},500)},o)}function t(e,a){a=isNaN(a)?3e3:a;var o=i.createElement("div");o.innerHTML=e,o.style.cssText="width:124px;opacity: 0.8;height: 40px;background:rgba(34,34,38,1);color: rgb(255, 255, 255);line-height: 40px;text-align: center;border-radius: 4px;position: fixed;top: 35%;left:50%;margin-left:-62px;z-index: 999999;font-size: 16px;",i.getElementById("user-ordertip").appendChild(o),setTimeout(function(){o.style.webkitTransition="-webkit-transform 0.5s ease-in, opacity 0.5s ease-in",o.style.opacity="0",setTimeout(function(){i.getElementById("user-ordertip").removeChild(o)},500)},a)}function n(){b="code_1",p("pay_error","已扫码<br>请在手机端操作",b)}function s(){b="code_2",p("pay_error","获取失败,点击重试",b)}function l(){b="code_3",p("pay_time_out","点击重新获取",b)}function p(e,i,o){a("#ordertip_notify").show().html('<img class="pay_icon" src="https://csdnimg.cn/release/download/images/'+e+'.png"/><span class="pay_tip">'+i+"</span>"),a("#ordertip_qr_code").html('<img src="https://csdnimg.cn/public/static/img/csdn-userimg250.gif" width="130" height="130"/>'),a("#ordertip_notify").find(".pay_icon, .pay_tip").off("click").on("click",function(){"code_2"==o&&t("支付失败","2000"),C.refearch(f.data)})}function c(){r("支付成功","2000")}var _="http"===location.protocol.substr(0,4)?"":"https:",g=_+"//g.csdnimg.cn/user-ordertip/2.0.8/images",u=_+"//g.csdnimg.cn/user-ordertip/2.0.8/user-ordertip.css";!function(e){var a=i.createElement("link");a.rel="stylesheet",a.type="text/css",a.href=e,i.getElementsByTagName("head")[0].appendChild(a)}(u),e.userOrderTip=e.userOrderTip?e.userOrderTip:{};var m=!0,f={},v={},h={},w="",x="",k="",b="",C={init:function(){this.checkPopup()},bindEvents:function(){a(i).off("click",".ordertip_dialog_wrapper .user_balance").on("click",".ordertip_dialog_wrapper .user_balance",function(){if(a(".ordertip_dialog_wrapper .user_balance").hasClass("disable"))return void(m=!1);a(".ordertip_dialog_wrapper .user_balance").hasClass("active")?(a(".ordertip_dialog_wrapper .user_balance").removeClass("active"),m=!1):(a(".ordertip_dialog_wrapper .user_balance").addClass("active"),m=!0);var e=f.data.new_price-f.data.available_amount<0?0:o(f.data.new_price,f.data.available_amount),i=Number(m?e:f.data.new_price).toFixed(2);f.data.new_price>0&&a(".ordertip_dialog_wrapper .amount_actually .num b").html(i),i>0?(a(".ordertip_dialog_wrapper .recharge_mode").removeClass("hid"),a(".ordertip_dialog_wrapper .anNiu").removeClass("via")):0==i&&(a(".ordertip_dialog_wrapper .recharge_mode").addClass("hid"),a(".ordertip_dialog_wrapper .anNiu").addClass("via")),C.checkPopup_1({goods_id:f.data.goods_id,product_id:f.data.product_id,flag:f.data.flag})}),a(i).off("click",".anNiu").on("click",".anNiu",function(e){window.location.href=""+x}),a(i).off("click",".agree img").on("click",".agree img",function(e){window.open("https://blogdev.blog.csdn.net/article/details/109030727","_blank")}),a(i).off("click",".titl").on("click",".titl",function(e){a(".ordertip_dialog_wrapper .titl_1").addClass("hid"),a(".ordertip_dialog_wrapper  .titl_2").removeClass("hid"),a(".ordertip_dialog_wrapper .titl").addClass("font"),a(".ordertip_dialog_wrapper  .ti").removeClass("font"),a(".ordertip_dialog_wrapper .ordertip_dialog_ka").addClass("no"),a(".ordertip_dialog_wrapper .ordertip_dialog_ka_1").addClass("display"),a(".ordertip_dialog_wrapper .agree").addClass("inlineBlock"),f={},m=!0,C.checkPopup_1({goods_id:h[0].ext.goodsId,product_id:h[0].ext.productId,flag:h[0].ext.flag})}),a(i).off("click",".ti").on("click",".ti",function(e){a(".ordertip_dialog_wrapper .titl_2").addClass("hid"),a(".ordertip_dialog_wrapper  .titl_1").removeClass("hid"),a(".ordertip_dialog_wrapper .ti").addClass("font"),a(".ordertip_dialog_wrapper  .titl").removeClass("font"),a(".ordertip_dialog_wrapper .ordertip_dialog_ka").removeClass("no"),a(".ordertip_dialog_wrapper .ordertip_dialog_ka_1").removeClass("display"),a(".ordertip_dialog_wrapper .agree").removeClass("inlineBlock");var i=v.filter(function(e,i,a){return 1==e.ext.default});f={},m=!0,C.checkPopup_1({goods_id:i[0].ext.goodsId,product_id:i[0].ext.productId,flag:i[0].ext.flag})}),a(i).off("click",".vip_2").on("click",".vip_2",function(e){f={},m=!0,C.checkPopup_1({goods_id:v[1].ext.goodsId,product_id:v[1].ext.productId,flag:v[1].ext.flag})}),a(i).off("click",".vip_3").on("click",".vip_3",function(e){f={},m=!0,C.checkPopup_1({goods_id:v[2].ext.goodsId,product_id:v[2].ext.productId,flag:v[2].ext.flag})}),a(i).off("click",".vip_4").on("click",".vip_4",function(e){f={},m=!0,C.checkPopup_1({goods_id:v[3].ext.goodsId,product_id:v[3].ext.productId,flag:v[3].ext.flag})}),a(i).off("click",".vip_1").on("click",".vip_1",function(e){f={},m=!0,C.checkPopup_1({goods_id:v[0].ext.goodsId,product_id:v[0].ext.productId,flag:v[0].ext.flag})}),a(i).off("click",".eBooks_1").on("click",".eBooks_1",function(e){f={},m=!0,C.checkPopup_1({goods_id:h[0].ext.goodsId,product_id:h[0].ext.productId,flag:h[0].ext.flag})}),a(i).off("click",".eBooks_2").on("click",".eBooks_2",function(e){f={},m=!0,C.checkPopup_1({goods_id:h[1].ext.goodsId,product_id:h[1].ext.productId,flag:h[1].ext.flag})}),a(i).off("click",".eBooks_3").on("click",".eBooks_3",function(e){f={},m=!0,C.checkPopup_1({goods_id:h[2].ext.goodsId,product_id:h[2].ext.productId,flag:h[2].ext.flag})}),a(i).off("click",".eBooks_4").on("click",".eBooks_4",function(e){f={},m=!0,C.checkPopup_1({goods_id:h[3].ext.goodsId,product_id:h[3].ext.productId,flag:h[3].ext.flag})}),a(i).on("click",".dialog_headerbtn",function(e){a("#user-ordertip-box").remove()}),a(i).on("click",".user_ordertip_dialog",function(e){a(e.target).hasClass("user_ordertip_dialog")&&a("#user-ordertip-box").remove()})},initDialog:function(e){C.bindEvents(),C.createDialogFn(e)},initDialog_1:function(e){C.bindEvents(),a(".ordertip_dialog_wrapper .ordertip_dialog_title span").html(e.name),a(".ordertip_dialog_wrapper .gift span").html(e.discount_msg),a(".ordertip_dialog_wrapper .commodity_box .user_balance .num").html(e.available_amount),a(".ordertip_dialog_wrapper .commodity_box .amount_actually em i").html(e.old_price),6==e.flag&&e.discount_msg?a(".gift").show():a(".gift").hide(),e.available_amount>0&&m?a(".ordertip_dialog_wrapper .user_balance").addClass("active"):(a(".ordertip_dialog_wrapper .user_balance").removeClass("active"),m=!1);var i=f.data.new_price-f.data.available_amount<0?0:o(f.data.new_price,f.data.available_amount),d=Number(m?i:f.data.new_price).toFixed(2);f.data.new_price>0&&a(".ordertip_dialog_wrapper .amount_actually .num b").html(d),d>0?(a(".ordertip_dialog_wrapper .recharge_mode").removeClass("hid"),a(".ordertip_dialog_wrapper .anNiu").removeClass("via")):0==d&&(a(".ordertip_dialog_wrapper .recharge_mode").addClass("hid"),a(".ordertip_dialog_wrapper .anNiu").addClass("via")),window.cart?(this.boxColor(e.goods_id),this.validateCode(e)):console.warn("cart_jsonp脚本不存在，请检查！")},boxColor:function(e){a(".ordertip_dialog_ka .dialog_vip").removeClass("color_gold"),a(".ordertip_dialog_ka_1 .dialog_vip").removeClass("color_gold"),e==v[0].ext.goodsId?a(".ordertip_dialog_ka .vip_1").addClass("color_gold"):e==v[3].ext.goodsId?a(".ordertip_dialog_ka .vip_4").addClass("color_gold"):e==v[1].ext.goodsId?a(".ordertip_dialog_ka .vip_2").addClass("color_gold"):e==v[2].ext.goodsId?a(".ordertip_dialog_ka .vip_3").addClass("color_gold"):e==h[0].ext.goodsId?a(".ordertip_dialog_ka_1 .eBooks_1").addClass("color_gold"):e==h[1].ext.goodsId?a(".ordertip_dialog_ka_1 .eBooks_2").addClass("color_gold"):e==h[2].ext.goodsId?a(".ordertip_dialog_ka_1 .eBooks_3").addClass("color_gold"):e==h[3].ext.goodsId&&a(".ordertip_dialog_ka_1 .eBooks_4").addClass("color_gold")},refearch:function(e){m=!0,C.checkPopup_1({goods_id:f.data.goods_id,product_id:f.data.product_id,flag:f.data.flag})},createDialogFn:function(i){this.createMask(),w=this.getQueryVariable("sale_source");m=i.available_amount>0;var d='<div id="user-ordertip">\n      <div class="user_ordertip_dialog">\n          <div class="ordertip_dialog_wrapper"  data-report-view=\'{"mod":"1597140593_002","spm":"3001.4292"}\'>\n              <div class="dialog_header">\n                  <div class="dialog_title">\n                    <div  class="ti"   data-report-view=\'{"mod":"1597140593_002","spm":"3001.4292","extend1":"CSDN会员"}\' data-report-click=\'{"mod":"1597140593_002","spm":"3001.4292","extend1":"CSDN会员"}\' > CSDN会员\n                      <div  class="titl_1"></div>\n                    </div>\n                  <div  class="titl"  data-report-view=\'{"mod":"1602731088","spm":"3001.4444","extend1":"电子书会员"}\'    data-report-click=\'{"mod":"1602731088","spm":"3001.4444","extend1":"电子书会员"}\'  >电子书会员\n                  <div  class="titl_2"></div>\n                  </div>\n              </div>\n                  <p  class="dialog_headerbtn"> + </p> \n              </div>\n              <div class="ordertip_dialog_wrap">\n              <div class="ordertip_dialog_ka">\n\n              </div>\n              <div class="ordertip_dialog_ka_1">\n                <div   class="'+("2"==h.length?"two":"forty")+'">\n                 \n                </div>\n             </div>\n              <div class="ordertip_dialog_header">\n                  <p class="ordertip_dialog_title">\n                     <span> '+i.name+' </span><i class="vip_qy"   > <img  src="'+g+'/vip.png" alt=""> 权益详情</i>\n                    \n                  </p>\n              </div>\n              <div class="ordertip_dialog_body">\n                  <li class="recharge_mode">\n                      <div class="recharge_mode_qr_code" id="ordertip_qr_code">\n                          <img class="loading" src="'+g+'/checked.png" width="50" height="50">\n                      </div>\n                      <div id="ordertip_notify" class="pay_notify"></div>\n                      <p class="scan_code">\n                          <img class="icon_item"\n                              src="https://csdnimg.cn/release/mall/7315efb/dist/images/dl_vip/wx.png" alt="img">\n                          <img class="icon_item"\n                              src="https://csdnimg.cn/release/mall/7315efb/dist/images/dl_vip/zfb.png" alt="img">\n                          <img class="icon_item"\n                              src="https://csdnimg.cn/release/mall/7315efb/dist/images/dl_vip/jd.png" alt="img">\n                          <span class="pay_intro">扫码支付</span>\n                      </p>\n                  </li>\n                  <div class="commodity_box">\n                      <ul class="commodity_desc">\n                          <li class="amount_actually">\n                              实付金额<span class="num">¥ <b>'+i.new_price+"</b></span><em>原价<i>"+i.old_price+'</i>元</em>\n                          </li>\n                          <li class="gift"  ><img   src="'+g+'/enjoy.png" alt=""> <span> '+i.discount_msg+' </span>\n                          </li>\n                          <li class="user_balance '+(0!=i.available_amount?"active":"disable")+'">\n                          <img src="'+g+'/unchecked.png" alt="" class="unchecked">\n                              <img src="'+g+'/checked.png" alt="" class="checked">\n                              钱包余额 <b class="num">'+i.available_amount+'</b>\n                              <div class="balance_tips_box">\n                                  <img src="'+g+'/help.png" alt="" class="help">\n                                  <span class="balance_tips">\n                                      <i class="chat"></i>\n                                      <b>抵扣说明：</b>\n                                      <em>1、余额是钱包充值的虚拟货币，按照1:1的比例进行支付金额的抵扣；</em>\n                                      <em>2、余额无法直接购买下载，可以购买VIP、C币套餐及课程；</em>\n                                  </span>\n                              </div>\n                          </li>\n                          <li class="agree  active" >\n                          支付即同意自动续费协议，自动续费15元/月，可随时取消<img src="'+g+'/help.png" alt="" class="help">\n                          </li>\n                          <li  class="anNiu"> \n                          确定支付\n                          </li>  \n                      </ul>\n                  </div>\n              </div>\n              </div>\n          </div>\n      </div>\n      <div class="ordertip_mask"></div>\n  </div>\n      ',r=a(d);a("#user-ordertip-box").append(r);var t="";v.forEach(function(e,i){t+=' <div class="dialog_vip vip_'+(i+1)+'" data-report-click=\'{"mod":"1597140593_002","spm":"3001.4292","extend1":"'+e.ext.price.split(".")[0]+'"}\'>\n                    <div class="vip_ka"> '+e.title.split("：")[0]+'</div>\n                    <p class="vip_meony"><span class="meony">¥</span> '+e.ext.price.split(".")[0]+'</p>\n                    <div class="'+(e.ext.default?"vip_tj":"no")+'" >推荐</div>\n                </div>'});var n=a(t);a(".ordertip_dialog_ka").append(n);var s="";h.forEach(function(e,i){s+='<div class="dialog_vip eBooks_'+(i+1)+'  data-report-click=\'{"mod":"1602731088","spm":"'+(1==e.ext.isContract?"3001.4445":"3001.4446")+'","extend1":"'+e.title+'"}\'>\n                <div class="vip_ka"> '+e.title.split("：")[0]+'</div>\n                <div class="vip_meony"><span class="meony">¥</span>'+Number(1==e.ext.isFirstOrder?e.ext.firstOrderPrice:e.ext.price).toFixed(1)+'\n                <i   class="'+("1"==e.ext.isContract?"monthy":"no")+'"  >连续包月￥'+(1==e.ext.isContract?e.ext.price:e.ext.originalPrice)+'/月 <i  class="'+("1"==e.ext.isFirstOrder?"vip_tj_1":"no")+'"  >首单特惠</i> </i>\n                <em   class="'+("0"==e.ext.isContract?"":"no")+'"  >原价'+e.ext.originalPrice+'元  </em>\n                </div>\n                <div class="'+("1"==e.ext.isContract?"vip_tj":"no")+'" >自动续费</div>\n            </div>'});var l=a(s);if(4==h.length?a(".forty").append(l):2==h.length&&a(".two").append(l),6==i.flag&&i.discount_msg?a(".gift").show():a(".gift").hide(),this.showNav(k),e.report&&window.csdn.report.viewCheck(),m){var p=f.data.new_price-f.data.available_amount<0?0:o(f.data.new_price,f.data.available_amount),c=Number(m?p:f.data.new_price).toFixed(2);f.data.new_price>0&&a(".ordertip_dialog_wrapper .amount_actually .num b").html(c),c>0?(a(".ordertip_dialog_wrapper .recharge_mode").removeClass("hid"),a(".ordertip_dialog_wrapper .anNiu").removeClass("via")):0==c&&(a(".ordertip_dialog_wrapper .recharge_mode").addClass("hid"),a(".ordertip_dialog_wrapper .anNiu").addClass("via"))}window.cart?(this.boxColor(i.goods_id),this.validateCode(i)):console.warn("cart_jsonp脚本不存在，请检查！")},showNav:function(e){"book.csdn.net"==e?(a(".ordertip_dialog_wrapper .titl_1").addClass("hid"),a(".ordertip_dialog_wrapper  .titl_2").removeClass("hid"),a(".ordertip_dialog_wrapper .titl").addClass("font"),a(".ordertip_dialog_wrapper  .ti").removeClass("font"),a(".ordertip_dialog_wrapper .ordertip_dialog_ka").addClass("no"),a(".ordertip_dialog_wrapper .ordertip_dialog_ka_1").addClass("display"),a(".ordertip_dialog_wrapper .eBooks_1").addClass("color_gold")):(a(".ordertip_dialog_wrapper .titl_2").addClass("hid"),a(".ordertip_dialog_wrapper  .titl_1").removeClass("hid"),a(".ordertip_dialog_wrapper .ti").addClass("font"),a(".ordertip_dialog_wrapper  .titl").removeClass("font"),a(".ordertip_dialog_wrapper .ordertip_dialog_ka").removeClass("no"),a(".ordertip_dialog_wrapper .ordertip_dialog_ka_1").removeClass("display"))},getQueryVariable:function(e){for(var i=window.location.search.substring(1),a=i.split("&"),o=0;o<a.length;o++){var d=a[o].split("=");if(d[0]==e)return d[1]}return""},validateCode:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.data;cart.qrPay({product_id:e.product_id,goods_id:e.goods_id,flag:e.flag,bind_vip:e.bind_vip,sale_source:w,is_use_balance:Number(m),coupon_key:e.coupon_key,success_function:d,error_function:s,timeout_function:l,payment_function:n,get_pay_success_callback:c,use_cache:!0})},createMask:function(){var e=i.createElement("div");e.id="user-ordertip-box",i.body.appendChild(e)},checkPopup:function(e){C.sendAjax("/mp/order/internal/getVipInfo","GET",function(e){e.code&&200==e.code?e.data&&C.initDialog(e.data):console.warn("该商品暂无数据")},e)},checkPopup_1:function(e){C.sendAjax("/mp/order/internal/getVipInfo","GET",function(e){e.code&&200==e.code?e.data&&C.initDialog_1(e.data):console.warn("该商品暂无数据")},e)},sendAjax:function(e,i,o,d){a.ajax({url:"https://mall.csdn.net/mp/order/internal/getVipInfo",type:i,dataType:"json",contentType:"application/json",async:!1,xhrFields:{withCredentials:!0},data:d||{},success:function(e){f=e,o(e)},error:function(e){if(e&&e.responseText){var i=JSON.parse(e.responseText)||{};i.message=i.message||"接口异常"}else o({})}})},getGoodId:function(e){a.ajax({url:"https://mall.csdn.net/mp/order/internal/vipList",type:"GET",dataType:"json",contentType:"application/json",async:!1,xhrFields:{withCredentials:!0},data:{},success:function(i){v=i.data.filter(function(e,i,a){return 6==e.ext.flag}),h=i.data.filter(function(e,i,a){return 28==e.ext.flag}),C.checkPopup(e)},error:function(e){if(e&&e.responseText){var i=JSON.parse(e.responseText)||{};i.message=i.message||"接口异常"}else callback({})}})}};e.userOrderTip.close=function(){a("#user-ordertip-box").remove()},e.userOrderTip.show=function(e){k=window.location.host,C.getGoodId(e)}}(window.csdn=window.csdn||{},document,jQuery);